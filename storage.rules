rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Allow read access to all users for public images (market photos, vendor posts, etc.)
    match /{allPaths=**} {
      allow read: if true;
    }

    // Vendor post photos - only authenticated vendors can upload
    match /vendor_posts/{postId}/{imageId} {
      allow write: if request.auth != null 
        && request.auth.uid != null;
      allow delete: if request.auth != null 
        && request.auth.uid != null;
    }

    // User profile photos - only the user can upload their own
    match /user_profiles/{userId}/{imageId} {
      allow write: if request.auth != null 
        && request.auth.uid == userId;
      allow delete: if request.auth != null 
        && request.auth.uid == userId;
    }

    // Market photos - only market organizers can upload
    match /markets/{marketId}/{imageId} {
      allow write: if request.auth != null 
        && request.auth.uid != null;
      allow delete: if request.auth != null 
        && request.auth.uid != null;
    }

    // General uploads folder for authenticated users
    match /uploads/{userId}/{allPaths=**} {
      allow write: if request.auth != null 
        && request.auth.uid == userId;
      allow delete: if request.auth != null 
        && request.auth.uid == userId;
    }
  }
}